<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Super Gift Catcher Pro!</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #1e3c72, #2a5298);
      color: white;
      overflow: hidden;
      font-family: 'Comic Sans MS', cursive;
    }
    #gameCanvas {
      background: rgba(255,255,255,0.15);
      border-bottom: 8px solid #228B22;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .gift { font-size: 48px; position: absolute; animation: fall linear; }
    @keyframes fall { from { top: -100px; } to { top: 100vh; } }
    #levelBadge { font-size: 1.8rem; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }
  </style>
</head>
<body class="text-center">
  <div class="container py-4">
    <h1 class="display-3 fw-bold text-warning shadow-lg">Super Gift Catcher Pro!</h1>
    
    <div class="row justify-content-center g-3 my-3">
      <div class="col-auto">
        <div class="card bg-dark text-white">
          <div class="card-body">
            Score: <strong id="score">0</strong>
          </div>
        </div>
      </div>
      <div class="col-auto">
        <div class="card bg-danger text-white">
          <div class="card-body">
            Missed: <strong id="missed">0</strong>/10
          </div>
        </div>
      </div>
      <div class="col-auto">
        <div class="card bg-info text-white">
          <div class="card-body">
            Level: <strong id="levelBadge">1</strong>
          </div>
        </div>
      </div>
      <div class="col-auto">
        <div class="card bg-warning text-dark">
          <div class="card-body">
            Best: <strong id="highScore">0</strong> 
          </div>
        </div>
      </div>
    </div>

    <div class="alert alert-danger d-none" id="gameOver">
      <h2>Game Over!</h2>
      <p>Final Score: <strong id="finalScore">0</strong></p>
      <p id="newRecord" class="display-6 text-warning d-none">NEW RECORD!</p>
    </div>
  </div>

  <div id="gameCanvas" class="position-relative mx-auto" style="width: 700px; height: 80vh;"></div>

  <div class="mt-4">
    <select id="difficulty" class="form-select w-auto d-inline-block mb-3">
      <option value="easy">Easy (Chill)</option>
      <option value="medium" selected>Medium (Fun)</option>
      <option value="hard">Hard (Insane!)</option>
    </select><br>
    <button class="btn btn-success btn-lg px-5" id="startBtn">
      <i class="bi bi-play-fill"></i> START GAME
    </button>
  </div>

  <!-- Sounds -->
  <audio id="catchSound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" preload="auto"></audio>
  <audio id="missSound" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-383.mp3" preload="auto"></audio>
  <audio id="gameOverSound" src="https://assets.mixkit.co/sfx/preview/mixkit-losing-arcade-game-2037.mp3" preload="auto"></audio>
  <audio id="levelUpSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" preload="auto"></audio>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const scoreEl = document.getElementById('score');
    const missedEl = document.getElementById('missed');
    const levelEl = document.getElementById('levelBadge');
    const highScoreEl = document.getElementById('highScore');
    const gameOverScreen = document.getElementById('gameOver');
    const finalScoreEl = document.getElementById('finalScore');
    const newRecordEl = document.getElementById('newRecord');
    const startBtn = document.getElementById('startBtn');
    const difficultySelect = document.getElementById('difficulty');

    // Sounds
    const sounds = {
      catch: document.getElementById('catchSound'),
      miss: document.getElementById('missSound'),
      gameOver: document.getElementById('gameOverSound'),
      levelUp: document.getElementById('levelUpSound')
    };

    let score = 0, missed = 0, level = 1, highScore = localStorage.getItem('giftHighScore') || 0;
    highScoreEl.textContent = highScore;
    let gameActive = false;
    const maxMissed = 10;
    const gifts = ['gift', 'christmas_tree', 'santa', 'deer', 'snowflake', 'bell', 'ribbon', 'star', 'candy_cane'];

    let player = { element: null, x: 300, width: 120 };
    let spawnInterval, levelInterval;

    function play(sound) { 
      sounds[sound].currentTime = 0; 
      sounds[sound].play().catch(()=>{}); 
    }

    function createPlayer() {
      player.element = document.createElement('div');
      player.element.innerHTML = 'basket';
      player.element.style.position = 'absolute';
      player.element.style.fontSize = '90px';
      player.element.style.bottom = '5px';
      player.element.style.left = player.x + 'px';
      player.element.style.transition = 'left 0.08s';
      player.element.style.cursor = 'grab';
      canvas.appendChild(player.element);
    }

    function movePlayer(e) {
      if (!gameActive) return;
      const rect = canvas.getBoundingClientRect();
      const clientX = e.clientX || e.touches[0].clientX;
      let newX = clientX - rect.left - player.width / 2;
      newX = Math.max(0, Math.min(700 - player.width, newX));
      player.x = newX;
      player.element.style.left = newX + 'px';
    }

    function getSpawnDelay() {
      const base = { easy: 1800, medium: 1200, hard: 700 }[difficultySelect.value];
      return base / Math.sqrt(level);
    }

    function createGift() {
      if (!gameActive) return;
      const gift = document.createElement('div');
      gift.className = 'gift';
      gift.innerHTML = gifts[Math.floor(Math.random() * gifts.length)];
      gift.style.left = Math.random() * (700 - 70) + 'px';
      gift.style.animationDuration = (3 + level * 0.3) + 's';
      canvas.appendChild(gift);

      const check = setInterval(() => {
        if (!gift.isConnected) { clearInterval(check); return; }
        const gRect = gift.getBoundingClientRect();
        const pRect = player.element.getBoundingClientRect();

        if (gRect.bottom >= pRect.top && gRect.left < pRect.right && gRect.right > pRect.left) {
          score++;
          scoreEl.textContent = score;
          play('catch');
          gift.remove();
          clearInterval(check);

          if (score > highScore) {
            highScore = score;
            highScoreEl.textContent = highScore;
            localStorage.setItem('giftHighScore', highScore);
          }

          if (score % 15 === 0) {
            level++;
            levelEl.textContent = level;
            play('levelUp');
            clearInterval(spawnInterval);
            spawnInterval = setInterval(createGift, getSpawnDelay());
          }
        }

        if (gRect.top > innerHeight) {
          missed++;
          missedEl.textContent = missed;
          play('miss');
          gift.remove();
          clearInterval(check);
          if (missed >= maxMissed) endGame();
        }
      }, 30);
    }

    function startGame() {
      score = 0; missed = 0; level = 1;
      scoreEl.textContent = score;
      missedEl.textContent = missed;
      levelEl.textContent = level;
      gameOverScreen.classList.add('d-none');
      newRecordEl.classList.add('d-none');
      gameActive = true;
      canvas.innerHTML = '';
      createPlayer();

      clearInterval(spawnInterval);
      spawnInterval = setInterval(createGift, getSpawnDelay());
    }

    function endGame() {
      gameActive = false;
      clearInterval(spawnInterval);
      play('gameOver');
      finalScoreEl.textContent = score;
      gameOverScreen.classList.remove('d-none');
      if (score >= highScore) {
        newRecordEl.classList.remove('d-none');
        confetti({ particleCount: 200, spread: 70, origin: { y: 0.6 } });
      }
    }

    // Events
    canvas.addEventListener('mousemove', movePlayer);
    canvas.addEventListener('touchmove', e => { e.preventDefault(); movePlayer(e.touches[0]); });
    startBtn.addEventListener('click', () => {
      startBtn.innerHTML = '<i class="bi bi-arrow-repeat"></i> RESTART';
      startGame();
    });

    // Welcome
    alert("Super Gift Catcher Pro!\n\nMove the basket with mouse or finger\nCatch gifts, avoid missing 10!\nBeat your high score for confetti!");
  </script>
</body>
</html>
